buildscript {
    repositories.gradlePluginPortal()
    dependencies.classpath "io.codearte.gradle.nexus:gradle-nexus-staging-plugin:0.21.1"
}

apply plugin: 'java-library'

group 'de.comroid'
version '1.0.0-SNAPSHOT'

apply from: 'gradle/vars.gradle'

def exportedProjects = [
        ':api',
        ':impl',
        ':core',
        ':util'
]

wrapper {
    gradleVersion = '5.6'
    distributionUrl = "https://services.gradle.org/distributions/gradle-$gradleVersion-all.zip"
}

sourceSets {
    main.java.srcDirs = []
    main.resources.srcDirs = []
    test.java.srcDirs = []
    test.resources.srcDirs = []
}

dependencies {
    api project(':api')
    runtimeOnly project(':impl')
    runtimeOnly project(':core')
}

allprojects {
    tasks.withType(Javadoc) {
        options {
            encoding = 'UTF-8'
            links = [
                    "https://docs.oracle.com/javase/8/docs/api/",
                    "https://docs.oracle.com/javaee/7/api/"
            ]
        }
    }
}

subprojects {
    apply plugin: 'java-library'

    group 'de.kaleidox'

    sourceCompatibility = 13
    targetCompatibility = 13

    task sourcesJar(type: Jar) {
        from sourceSets.main.allJava
        archiveClassifier = "sources"
    }

    task javadocJar(type: Jar) {
        //javadoc
        from javadoc.destinationDir
        archiveClassifier = "javadoc"
    }

    compileJava.options.encoding = 'UTF-8'
    repositories.jcenter()

    dependencies {
        implementation 'com.google.flogger:flogger:0.4'
        compileOnly 'org.jetbrains:annotations:17.0.0'

        testImplementation 'junit:junit:4.12'
        testImplementation 'org.easymock:easymock:4.0.2'
        testImplementation 'com.google.flogger:flogger-system-backend:0.4'
    }
}

project(":api") {
    version = '2.0.0'

    dependencies {
        compileOnly 'com.alibaba:fastjson:1.2.61'

        testImplementation 'org.reflections:reflections:0.9.11'
    }
}

project(":core") {
    version = '2.0.0'

    dependencies {
        api project(':api')

        implementation 'com.alibaba:fastjson:1.2.61'

        runtimeOnly 'com.google.flogger:flogger-system-backend:0.4'
    }
}

project(":impl") {
    version = '2.0.0'

    dependencies {
        api project(':api')
        api project(':core')

        implementation 'com.alibaba:fastjson:1.2.61'

        runtimeOnly 'com.google.flogger:flogger-system-backend:0.4'
    }
}

project(":util") {
    version = '2.0.0'
}

task allJavadoc(type: Javadoc) {
    source exportedProjects.collect { project(it).sourceSets.main.allJava }
    classpath = files(exportedProjects.collect { project(it).sourceSets.main.compileClasspath })
    options.encoding = 'UTF-8'
    options.destinationDirectory(file("./docs/"))
}

apply from: 'gradle/publishing.gradle'
